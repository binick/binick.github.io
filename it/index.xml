<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>a developer&#39;s journey to the cloud</title>
    <link>https://binick.blog/it/</link>
    <description>Recent content on a developer&#39;s journey to the cloud</description>
    <generator>Hugo -- gohugo.io</generator>
    <managingEditor>nicola.biancolini@gmail.com (Nicola Biancolini)</managingEditor>
    <webMaster>nicola.biancolini@gmail.com (Nicola Biancolini)</webMaster>
    <copyright>Il codice sorgente di questo sito è disponibile [qui](https://github.com/binick/binick.github.io), licenziato sotto GPLv3.</copyright>
    <lastBuildDate>Fri, 18 Feb 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://binick.blog/it/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Quella volta nella quale ho assaggiato una rana</title>
      <link>https://binick.blog/it/2022/02/18/daily-milestone/</link>
      <pubDate>Fri, 18 Feb 2022 00:00:00 +0000</pubDate>
      <author>nicola.biancolini@gmail.com (Nicola Biancolini)</author>
      <guid>https://binick.blog/it/2022/02/18/daily-milestone/</guid>
      <description>Liberare la mente da pensieri inutili come ad esempio la lista di cose da fare si è rivelata una per me un&amp;#39;ottima cosa. Trovare la giusta via per ottenerlo non e&amp;#39; stato tuttavia cosi semplice.</description>
      <content:encoded><![CDATA[<p>Ho iniziato a lavorare in modalità remota a Marzo 2020, la ragione immagino la conosciamo tutti.</p>
<blockquote>
<p>Comunque se un extra terrestre dovesse leggere questo post qua potrà trovare maggiori informazioni <a href="https://wikipedia.org/wiki/COVID-19">https://wikipedia.org/wiki/COVID-19</a>.</p>
</blockquote>
<p>L&rsquo;esperienza è stata quella di molti immagino, un uso massimo ed indiscriminato di piattaforme di comunicazione ed orecchi fumanti a fine giornata.<br>
Quest&rsquo;esperienza è andata avanti all&rsquo;incirca per un anno e mezzo, 16 mesi per la precisione, fino a Luglio 2021 quando sono entrato in <a href="https://www.manageddesigns.it/"><em>managed/designs</em></a>.</p>
<!-- 
  Todo {working-in-md}.
  Replate {working-in-md} with link to ../working-in-md post, when available.
-->
<!-- {working-in-md} -->
<p>Qui ho trovato un ambiente differente, alcuni lo definirebbero <em>smart</em>, votato alla crescita personale ed al miglioramento continuo, dove autonomia e fiducia sono due pilastri sulle quali si basa la collaborazione giornaliera.</p>
<!-- {working-in-md} --> 
<h2 id="prologo">Prologo.</h2>
<p>Non sono mai stato un utilizzatore delle liste di cose da fare, forse per inesperienza o forse per qualche mia convinzione a me sconosciuta. Sta di fatto che il fallire sistematico nel seguire la lista della spesa ne è una prova <em>&ldquo;Nicola non è capace a gestire le liste&rdquo;</em>.</p>
<p>Una volta presa consapevolezza di ciò mi sono messo alla ricerca di possibili pattern e/o metodologie individuandone alcune che mi stanno accompagnando da un paio di mesi.</p>
<h2 id="la-mia-inbox-non-è-la-mail">La mia inbox non è la mail.</h2>
<p>Ho compreso che quello di cui ho bisogno non è una lista di attività <em>da fare</em> ma piuttosto una lista di cose che <em>vorrei fare</em> o che in qualche modo attira il mio interesse, credo che a livello inconscio il mio cervello prenda con ottimismo la mancanza di quel <em>&ldquo;da&rdquo;</em> che genera pressione per cose verso le quali non dovrebbe esserci.</p>
<p>Ho tre mail, quella aziendale ed altre due storiche che mi porto dietro da almeno un decennio, tutte e tre seguono la filosofia dell'<a href="https://www.43folders.com/izero" title="Indice degli articoli inerenti la tecnica Inbox Zero">Inbox Zero</a> di <a href="http://www.merlinmann.com/" title="Sito personale di Merlin Mann">Merlin Mann</a>. Al momento le sfoglio due volte al giorno, all&rsquo;incirca prima di pranzo e prima della fine della giornata, questi slot sono degli appuntamenti ricorrenti sul calendario fino al prossimo 29 di Giugno, vedremo se saranno prolungati ma credo di si.</p>
<p>La regola è molto semplice:</p>
<ul>
<li>è importante e deve essere eseguita in un preciso momento: viene creato un appuntamento sul calendario e viene archiviata nella relativa casella di posta</li>
<li>è importante: finisce nell'<em>inbox</em> e viene archiviata</li>
<li>mi interessa: finisce nell'<em>inbox</em> e viene eliminata</li>
<li>non mi interessa: finisce subito nel cestino</li>
</ul>
<p>In questo modo ho sempre le caselle di posta libere e riesco a mantenere l&rsquo;attenzione sullo su quella decina di mail.</p>
<p>Se arriva una mail che richiede un&rsquo;interazione attiva non la eseguirò subito ma come per le altre sottostarà alle regole qui sopra.</p>
<h2 id="una-rana-al-giorno-è-sufficiente">Una rana al giorno è sufficiente.</h2>
<p>L&rsquo;altra tecnica per me illuminante è stata l&rsquo;aver scoperto la regola dell'1-3-5<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> che trova fondamento sulla pratica di mangiare una rana appena svegli<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. Ovviamente non fisicamente, non mi vorrei mai svegliare ed ultimamente dormo anche poco!</p>
<p>Per cui il giorno prima faccio la lista di quello che vorrei fare l&rsquo;indomani applicando una sorta di prioritizzazione delle attività abbastanza empirica al momento stando sempre attendo che vi sia almeno una rana ed eventualmente altre attività riempitive.</p>
<h2 id="epilogo">Epilogo.</h2>
<p>Devo essere onesto, all’inizio ero scettico sull’impiegare del tempo organizzare il mio domani. Devo riscredermi, il beneficio di scaricare il cervello dall&rsquo;onere di pensare a cosa fare per non correre il rischio di perderla per sempre è una cosa da non sottovalutare.</p>
<p>Al momento la rigidità del calendario e la flessibilità che mi lascia la lista 1-3-5 sono un buon connubio. Solo il tempo saprà dire se è una scelta per me vincente.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://www.themuse.com/advice/why-you-never-finish-your-todo-lists-at-work-and-how-to-change-that">Why You Never Finish Your To-Do Lists at Work (And How to Change That)</a> di <a href="https://www.themuse.com/author/alex-cavoulacos">Alex Cavoulacos</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://www.briantracy.com/blog/time-management/the-truth-about-frogs">Eat That Frog: Brian Tracy Explains the Truth About Frogs</a> di Brian Tracy&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content:encoded>
    </item>
    
    <item>
      <title>Sviluppare soluzioni integrate con Active Directory B2C ed Azure Event Grid.</title>
      <link>https://binick.blog/it/2022/01/08/aadb2c-subscribe-to-user-registration-event/</link>
      <pubDate>Sat, 08 Jan 2022 00:00:00 +0000</pubDate>
      <author>nicola.biancolini@gmail.com (Nicola Biancolini)</author>
      <guid>https://binick.blog/it/2022/01/08/aadb2c-subscribe-to-user-registration-event/</guid>
      <description>Vediamo come è possibile integrare la registrazione di un utente.</description>
      <content:encoded><![CDATA[<p>In un articolo precedente abbiamo visto <a href="https://www.ugidotnet.org/tip/2873/Arricchire-JWT-emessi-da-Active-Directory-B2C-con-criteri-personalizzati" title="Arricchire token JWT emessi da Azure Active Directory B2C." target="_blank">Arricchire token JWT emessi da Azure Active Directory B2C</a>.</p>
<p>In quell&rsquo;articolo abbiamo parlato di come sia possibile aggiungere ad un JWT informazioni esterne a <em>Microsoft Graph</em> mediante l&rsquo;uso di una <em>Logic App</em> ed un <em>Blob Storage</em>.</p>
<p>In questo invece vedremo come sia possibile creare una soluzioni che integri <em>Azure Active Directory B2C</em>.</p>
<p>Seguendo la traccia di quanto trattato nel precedente articolo vedremo come salvare su <em>Blob Storage</em> dati fittizi alla registrazione di un utente.</p>


<p><details >
  <summary markdown="span">Note</summary>
  Nel resto dell&rsquo;articolo ci sono riferimenti a risorse e concetti trattati nel <a href="https://www.ugidotnet.org/tip/2873/Arricchire-JWT-emessi-da-Active-Directory-B2C-con-criteri-personalizzati" title="Arricchire token JWT emessi da Azure Active Directory B2C." target="_blank">precedente articolo</a> al quale si rimanda.
</details></p>

<h2 id="panoramica-della-soluzione">Panoramica della soluzione.</h2>
<p>La soluzione è cosi composta:</p>
<figure class="align-center background-light">
    <img loading="lazy" src="component-map.svg#center"
         alt="Composizione della soluzione"/> <figcaption>
            <p>Composizione della soluzione</p>
        </figcaption>
</figure>

<ul>
<li><code>read-customer-details-identity-la</code>: rappresenta l&rsquo;api il cui scopo è reperire il contenuto del <em>blob</em> da <code>customersstgacc</code> (lo <em>storage account</em>)</li>
<li><code>customer-register-tpc</code>: è il <em>topic</em> nel quale sono collezionati gli eventi di creazione di un nuovo utente</li>
<li><code>customer-identity-details-filler-la</code>: rappresenta l&rsquo;api al quale spetta l&rsquo;onere di generare dati fittizi che poi saranno salvati all&rsquo;interno di un <em>blob</em> sullo <code>customersstgacc</code>
<figure class="align-center ">
    <img loading="lazy" src="logic-app-steps.png#center"
         alt="Definizione della logic app"/> 
</figure>
</li>
<li><code>contoso-b2c</code>: è il servizio di gestione degli accessi e delle identità offerto da <em>Azure</em></li>
</ul>
<h2 id="introduzione-ad-_azure-event-grid_">Introduzione ad <em>Azure Event Grid</em>.</h2>
<p>In <em>Azure</em> esiste un&rsquo;implementazione del pattern <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">publish/subscribe</a> concepita per agevolare l&rsquo;integrazione e la gestione delle risorse mediante un paradigma di sviluppo ad eventi.</p>
<p>Mediante <em>Event Grid</em> sarà quindi possibile sottoscriversi a <a href="https://docs.microsoft.com/azure/event-grid/overview#event-sources">sorgenti di messaggi built-in</a> attraverso una <a href="https://docs.microsoft.com/azure/event-grid/overview#event-handlers">serie di gestori</a>.</p>
<p>Qual&rsquo;ora questo non fosse sufficiente è comunque possibile creare dei <em>topic</em> personalizzati ai quali sarà possibile sottoscriversi per riceverne gli eventi.</p>
<h2 id="creazione-di-un-_topic_-personalizzato">Creazione di un <em>topic</em> personalizzato.</h2>
<p>Per la creazione di un <em>topic</em> è possibile fare riferimento a <a href="https://docs.microsoft.com/azure/event-grid/custom-event-quickstart-portal#create-a-custom-topic">questa guida</a>.</p>
<p>Una scelta da fare al momento della creazione del <em>topic</em> riguarda lo schema del contenuto della richiesta <em>HTTP</em> utilizzato. Gli schemi supportati al momento sono:</p>
<ul>
<li><a href="https://docs.microsoft.com/azure/event-grid/event-schema"><code>Event Grid Schema</code></a></li>
<li><a href="https://docs.microsoft.com/azure/event-grid/cloud-event-schema"><code>Cloud Event Schema</code></a></li>
<li><code>Custom Input Schema</code>, questo schema richiederà la creazione di un'<a href="https://docs.microsoft.com/azure/event-grid/input-mappings">associazione</a> fra le proprietà dell&rsquo;oggetto in ingresso e quelle richieste dallo <code>Event Grid Schema</code>.</li>
</ul>
<p>Il messaggio usato in questo caso ha la seguente struttura</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="ln" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a></span><span class="p">[</span>
<span class="ln" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a></span>    <span class="p">{</span>
<span class="ln" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a></span>        <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
<span class="ln" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a></span>            <span class="nt">&#34;objectId&#34;</span><span class="p">:</span> <span class="s2">&#34;25100647-****-4571-****-b03e4ce72d02&#34;</span> <span class="c1">// l&#39;identificativo utile ad identificare l&#39;utente
</span><span class="ln" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a></span><span class="c1"></span>        <span class="p">},</span>
<span class="ln" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a></span>        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;25100647-****-4571-****-b03e4ce72d02&#34;</span><span class="p">,</span> <span class="c1">// l&#39;identificativo univoco del messaggio, lo stesso di `data.objectId` in qesto caso
</span><span class="ln" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a></span><span class="c1"></span>        <span class="nt">&#34;eventType&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.ActiveDirectory&#34;</span><span class="p">,</span> 
<span class="ln" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a></span>        <span class="nt">&#34;subject&#34;</span><span class="p">:</span> <span class="s2">&#34;*.onmicrosoft.com&#34;</span><span class="p">,</span>
<span class="ln" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a></span>        <span class="nt">&#34;dataVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0&#34;</span><span class="p">,</span>
<span class="ln" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a></span>        <span class="nt">&#34;metadataVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
<span class="ln" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a></span>        <span class="nt">&#34;eventTime&#34;</span><span class="p">:</span> <span class="s2">&#34;2021-12-03T21:04:03.8504745Z&#34;</span><span class="p">,</span>
<span class="ln" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a></span>        <span class="nt">&#34;topic&#34;</span><span class="p">:</span> <span class="s2">&#34;/subscriptions/{your-subscription-id}/resourceGroups/{your-resource-group}/providers/Microsoft.EventGrid/topics/{your-event-grid-topic}&#34;</span>
<span class="ln" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a></span>    <span class="p">}</span>
<span class="ln" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a></span><span class="p">]</span>
</code></pre></div><h2 id="emissione-dellevento-di-registrazione">Emissione dell&rsquo;evento di registrazione.</h2>
<p>L&rsquo;invio degli eventi verso il <em>topic</em> avviene utilizzando un <a href="https://docs.microsoft.com/azure/active-directory-b2c/restful-technical-profile"><code>RESTful technical profile</code></a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="ln" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a></span><span class="nt">&lt;TechnicalProfile</span> <span class="na">Id=</span><span class="s">&#34;AAD-UserEmitRegistrationEvent&#34;</span><span class="nt">&gt;</span>
<span class="ln" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a></span>    <span class="nt">&lt;DisplayName&gt;</span>Emit user registration event to Event Grid.<span class="nt">&lt;/DisplayName&gt;</span>
<span class="ln" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a></span>    <span class="nt">&lt;Protocol</span> <span class="na">Name=</span><span class="s">&#34;Proprietary&#34;</span> <span class="na">Handler=</span><span class="s">&#34;Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a></span>    <span class="nt">&lt;Metadata&gt;</span>
<span class="ln" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a></span>        <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&#34;ServiceUrl&#34;</span><span class="nt">&gt;</span>{Settings:CustomerRegisteredTopicUrl}<span class="nt">&lt;/Item&gt;</span>
<span class="ln" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a></span>        <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&#34;AuthenticationType&#34;</span><span class="nt">&gt;</span>ApiKeyHeader<span class="nt">&lt;/Item&gt;</span>
<span class="ln" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a></span>        <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&#34;SendClaimsIn&#34;</span><span class="nt">&gt;</span>Body<span class="nt">&lt;/Item&gt;</span>
<span class="ln" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a></span>        <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&#34;ClaimUsedForRequestPayload&#34;</span><span class="nt">&gt;</span>userRegisterEvent<span class="nt">&lt;/Item&gt;</span>
<span class="ln" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a></span>        <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&#34;DefaultUserMessageIfRequestFailed&#34;</span><span class="nt">&gt;</span>Cannot process your request right now, please try again later.<span class="nt">&lt;/Item&gt;</span>
<span class="ln" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a></span>    <span class="nt">&lt;/Metadata&gt;</span>
<span class="ln" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a></span>    <span class="nt">&lt;CryptographicKeys&gt;</span>
<span class="ln" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a></span>        <span class="nt">&lt;Key</span> <span class="na">Id=</span><span class="s">&#34;aeg-sas-key&#34;</span> <span class="na">StorageReferenceId=</span><span class="s">&#34;B2C_1A_CustomerRegisteredTopicSas&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a></span>    <span class="nt">&lt;/CryptographicKeys&gt;</span>
<span class="ln" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a></span>    <span class="nt">&lt;InputClaimsTransformations&gt;</span>
<span class="ln" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a></span>        <span class="nt">&lt;InputClaimsTransformation</span> <span class="na">ReferenceId=</span><span class="s">&#34;GetSystemDateTime&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a></span>        <span class="nt">&lt;InputClaimsTransformation</span> <span class="na">ReferenceId=</span><span class="s">&#34;GenerateRegistrationEventRequest&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a></span>    <span class="nt">&lt;/InputClaimsTransformations&gt;</span>
<span class="ln" id="18"><a style="outline: none; text-decoration:none; color:inherit" href="#18">18</a></span>    <span class="nt">&lt;InputClaims&gt;</span>
<span class="ln" id="19"><a style="outline: none; text-decoration:none; color:inherit" href="#19">19</a></span>        <span class="nt">&lt;InputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;userRegisterEvent&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="20"><a style="outline: none; text-decoration:none; color:inherit" href="#20">20</a></span>    <span class="nt">&lt;/InputClaims&gt;</span>
<span class="ln" id="21"><a style="outline: none; text-decoration:none; color:inherit" href="#21">21</a></span>    <span class="nt">&lt;PersistedClaims&gt;</span>
<span class="ln" id="22"><a style="outline: none; text-decoration:none; color:inherit" href="#22">22</a></span>        <span class="nt">&lt;PersistedClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;systemDateTime&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="23"><a style="outline: none; text-decoration:none; color:inherit" href="#23">23</a></span>    <span class="nt">&lt;/PersistedClaims&gt;</span>
<span class="ln" id="24"><a style="outline: none; text-decoration:none; color:inherit" href="#24">24</a></span>    <span class="nt">&lt;UseTechnicalProfileForSessionManagement</span> <span class="na">ReferenceId=</span><span class="s">&#34;SM-AAD&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="25"><a style="outline: none; text-decoration:none; color:inherit" href="#25">25</a></span><span class="nt">&lt;/TechnicalProfile&gt;</span>
</code></pre></div><p>Questo frammento di markup tradotto in comando <code>curl</code>, per maggiore esplicabilità, risulterebbe cosi:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a></span>curl -X POST -H <span class="s2">&#34;aeg-sas-key: </span><span class="nv">$key</span><span class="s2">&#34;</span> -d <span class="s2">&#34;</span><span class="nv">$event</span><span class="s2">&#34;</span> <span class="nv">$endpoint</span>
</code></pre></div><p>dove i requisiti di autenticazione vengono soddisfatti dal metadato <code>AuthenticationType</code> al quale viene associata la chiave crittografica <code>aeg-sas-key</code> il cui valore viene recuperato dalla chiave <code>B2C_1A_CustomerRegisteredTopicSas</code> presente nella collezione delle <a href="https://docs.microsoft.com/azure/active-directory-b2c/policy-keys-overview?pivots=b2c-custom-policy">chiavi dei criteri</a>.</p>


<p><details >
  <summary markdown="span">TL;DR</summary>
  La scelta dello <em>schema</em> del <em>topic</em> in questo esempio è stata guidata dalle limitazioni al momento imposte dal <a href="https://docs.microsoft.com/azure/active-directory-b2c/restful-technical-profile"><em>profilo tecnico RESTful</em></a> riguardo alle possibilità di costruzione della richiesta <em>HTTP</em>, infatti per una combinazione di criteri non risulta possibile passare informazioni nelle intestazioni e nel corpo della richiesta allo stesso tempo.<br>
Ciò rende impossibile inviare verso un <em>topic</em> schemi di tipo <code>Cloud Event</code> in quanto il protocollo, nella versione <em>1.0</em> richiede la presenza di un'<a href="https://docs.microsoft.com/azure/event-grid/cloud-event-schema#sample-event-using-cloudevents-schema">intestazione obbligatoria</a>.
</details></p>

<p>Ben più complessa è la creazione del corpo della richiesta per la quale risultano necessario:</p>
<ul>
<li>utilizzare le <a href="https://docs.microsoft.com/azure/active-directory-b2c/technicalprofiles#input-claims-transformations"><code>InputClaimsTransformation</code></a></li>
<li>aggiungere due attestazioni all&rsquo;interno del bagaglio <code>userRegisterEvent</code> e <code>systemDateTime</code> entrambe di tipo <em>stringa</em>.</li>
</ul>
<p>Infine il <em>profilo tecnico</em> è stato aggiunto fra i <em>profili tecnici di validazione</em> di <a href="https://github.com/binick/samples/blob/7782bd6bfcfcb8c2b18dc911d501b29ec05f8212/src/enrich-a-jwt-token-with-ief/ief/TrustFrameworkBase.xml#L764"><code>LocalAccountSignUpWithLogonEmail</code></a> in modo tale che l&rsquo;evento venga emesso solamente in fase di registrazione di un&rsquo;utente.</p>
<h3 id="utilizzo-delle-trasformazioni-delle-attestazioni">Utilizzo delle trasformazioni delle attestazioni.</h3>
<p>Durante la creazione di <em>criteri personalizzati</em> potremmo avere la necessità di eseguire calcoli, come ad esempio il numero di tentativi di autenticazione, che seppur molto semplici risulterebbero impossibili senza l&rsquo;esecuzioni di funzioni.</p>
<p>Questo requisito trova espressività tramite le <code>ClaimsTransformation</code> il cui <a href="https://docs.microsoft.com/azure/active-directory-b2c/claimstransformations#claims-transformations-reference">riferimento delle trasformazioni delle attestazioni</a> contiene la lista completa delle <em>trasformazioni</em> utilizabili.</p>
<p>Nell&rsquo;esempio sono stati utilizzati i metodi <a href="https://docs.microsoft.com/azure/active-directory-b2c/date-transformations#getcurrentdatetime"><code>GetCurrentDateTime</code></a> e <a href="https://docs.microsoft.com/azure/active-directory-b2c/json-transformations#generatejson"><code>GenerateJson</code></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="ln" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a></span><span class="nt">&lt;ClaimsTransformation</span> <span class="na">Id=</span><span class="s">&#34;GetSystemDateTime&#34;</span> <span class="na">TransformationMethod=</span><span class="s">&#34;GetCurrentDateTime&#34;</span><span class="nt">&gt;</span>
<span class="ln" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a></span>    <span class="nt">&lt;OutputClaims&gt;</span>
<span class="ln" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a></span>        <span class="nt">&lt;OutputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;systemDateTime&#34;</span> <span class="na">TransformationClaimType=</span><span class="s">&#34;currentDateTime&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a></span>    <span class="nt">&lt;/OutputClaims&gt;</span>
<span class="ln" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5">5</a></span><span class="nt">&lt;/ClaimsTransformation&gt;</span>
</code></pre></div><p><code>GetSystemDateTime</code> ha lo scopo di valorizzare l&rsquo;attestazione <code>systemDateTime</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="ln" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a></span><span class="nt">&lt;ClaimsTransformation</span> <span class="na">Id=</span><span class="s">&#34;GenerateRegistrationEventRequest&#34;</span> <span class="na">TransformationMethod=</span><span class="s">&#34;GenerateJson&#34;</span><span class="nt">&gt;</span>
<span class="ln" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a></span>    <span class="nt">&lt;InputClaims&gt;</span>
<span class="ln" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a></span>        <span class="nt">&lt;InputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;objectId&#34;</span> <span class="na">TransformationClaimType=</span><span class="s">&#34;0.data.objectId&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a></span>        <span class="nt">&lt;InputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;objectId&#34;</span> <span class="na">TransformationClaimType=</span><span class="s">&#34;0.id&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a></span>        <span class="nt">&lt;InputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;systemDateTime&#34;</span> <span class="na">TransformationClaimType=</span><span class="s">&#34;0.eventTime&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a></span>    <span class="nt">&lt;/InputClaims&gt;</span>
<span class="ln" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a></span>    <span class="nt">&lt;InputParameters&gt;</span>
<span class="ln" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a></span>        <span class="nt">&lt;InputParameter</span> <span class="na">Id=</span><span class="s">&#34;0.dataVersion&#34;</span> <span class="na">DataType=</span><span class="s">&#34;string&#34;</span> <span class="na">Value=</span><span class="s">&#34;1.0&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a></span>        <span class="nt">&lt;InputParameter</span> <span class="na">Id=</span><span class="s">&#34;0.eventType&#34;</span> <span class="na">DataType=</span><span class="s">&#34;string&#34;</span> <span class="na">Value=</span><span class="s">&#34;Microsoft.ActiveDirectory&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a></span>        <span class="nt">&lt;InputParameter</span> <span class="na">Id=</span><span class="s">&#34;0.subject&#34;</span> <span class="na">DataType=</span><span class="s">&#34;string&#34;</span> <span class="na">Value=</span><span class="s">&#34;{Settings:Tenant}&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a></span>    <span class="nt">&lt;/InputParameters&gt;</span>
<span class="ln" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a></span>    <span class="nt">&lt;OutputClaims&gt;</span>
<span class="ln" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a></span>        <span class="nt">&lt;OutputClaim</span> <span class="na">ClaimTypeReferenceId=</span><span class="s">&#34;userRegisterEvent&#34;</span> <span class="na">TransformationClaimType=</span><span class="s">&#34;outputClaim&#34;</span> <span class="nt">/&gt;</span>
<span class="ln" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a></span>    <span class="nt">&lt;/OutputClaims&gt;</span>
<span class="ln" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a></span><span class="nt">&lt;/ClaimsTransformation&gt;</span>
</code></pre></div><p><code>GenerateRegistrationEventRequest</code> ha invece l&rsquo;onere di costruire il JSON e valorizzare l&rsquo;attestazione <code>userRegisterEvent</code>.</p>
<h2 id="conclusioni">Conclusioni.</h2>
<p>In questo articolo abbiamo visto come mediante <em>Identity Experience Framework</em> sia possibile integrare un tenant B2C con la nostra infrastruttura ed aprire eventuali scenari di sviluppo interessanti.<br>
Per farlo abbiamo toccato <em>Azure Event Grid</em> e come creare un <em>Event Grid Topic</em>.</p>
<p>Infine come sia possibile <a href="https://docs.microsoft.com/azure/active-directory-b2c/claimstransformations#claims-transformations-reference">manipolare delle attestazioni</a> ed utilizzarle all&rsquo;interno dei <a href="https://docs.microsoft.com/azure/active-directory-b2c/technicalprofiles"><em>profili tecnici</em></a>.</p>
<p>Se foste interessati all’esempio completo lo potrete trovare al seguente indirizzo <a href="https://github.com/binick/samples/tree/master/src/enrich-a-jwt-token-with-ief">https://github.com/binick/samples/tree/master/src/enrich-a-jwt-token-with-ief</a>.</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Arricchire token JWT emessi da Azure Active Directory B2C</title>
      <link>https://binick.blog/it/2021/12/27/enrich-a-jwt-token-with-ief/</link>
      <pubDate>Mon, 27 Dec 2021 00:00:00 +0000</pubDate>
      <author>nicola.biancolini@gmail.com (Nicola Biancolini)</author>
      <guid>https://binick.blog/it/2021/12/27/enrich-a-jwt-token-with-ief/</guid>
      <description>Personalizzare un JSON Web Token emesso da Azure Active Directory B2C con informazioni presenti su un sistema esterno è possibile: è sufficiente, infatti, sfruttare le possibilità di personalizzazione offerte dai criteri personalizzati.</description>
      <content:encoded><![CDATA[]]></content:encoded>
    </item>
    
  </channel>
</rss>
